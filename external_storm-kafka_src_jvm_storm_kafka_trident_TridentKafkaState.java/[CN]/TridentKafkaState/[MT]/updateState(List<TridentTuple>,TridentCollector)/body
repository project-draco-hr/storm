{
  for (  final TridentTuple tuple : tuples) {
    final String topic=topicSelector.getTopic(tuple);
    if (topic != null) {
      producer.send(new ProducerRecord(topic,mapper.getKeyFromTuple(tuple),mapper.getMessageFromTuple(tuple)),new Callback(){
        @Override public void onCompletion(        RecordMetadata metadata,        Exception ex){
          if (ex != null) {
            String errorMsg="Could not send message with key = " + mapper.getKeyFromTuple(tuple) + " to topic = "+ topic;
            LOG.warn(errorMsg,ex);
            throw new FailedException(errorMsg,ex);
          }
        }
      }
);
    }
 else {
      LOG.warn("skipping key = " + mapper.getKeyFromTuple(tuple) + ", topic selector returned null.");
    }
  }
}
