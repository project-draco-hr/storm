{
  TransactionAttempt tx=(TransactionAttempt)msgId;
  TransactionStatus status=_activeTx.get(tx.getTransactionId());
  if (!tx.equals(status.attempt)) {
    throw new IllegalStateException("Coordinator got into a bad state: acked transaction " + tx.toString() + " does not match up with stored attempt: "+ status);
  }
  if (status.status == AttemptStatus.PROCESSING) {
    status.status=AttemptStatus.PROCESSED;
  }
 else   if (status.status == AttemptStatus.COMMITTING) {
    _activeTx.remove(tx.getTransactionId());
    _spout.cleanupTransaction(_currTransaction);
    _coordinatorState.commit(tx.getTransactionId());
    _currTransaction=nextTransactionId(tx.getTransactionId());
    _state.setData(CURRENT_TX,_currTransaction);
  }
  sync();
}
