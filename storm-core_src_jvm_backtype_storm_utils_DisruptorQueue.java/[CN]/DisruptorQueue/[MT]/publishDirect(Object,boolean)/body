{
  final long id;
  if (block) {
    id=_buffer.next();
  }
 else {
    id=_buffer.tryNext(1);
  }
  final AtomicReference<Object> m=_buffer.get(id);
  Object old=m.getAndSet(obj);
  _buffer.publish(id);
  _metrics.notifyArrivals(1);
  if (_enableBackpressure && _cb != null && _metrics.population() >= _highWaterMark) {
    try {
      if (!_throttleOn) {
        _cb.highWaterMark();
        _throttleOn=true;
      }
    }
 catch (    Exception e) {
      throw new RuntimeException("Exception during calling highWaterMark callback!",e);
    }
  }
  if (old != null) {
    LOG.warn("Tuple was overwritten in {}:{}",getName(),id);
  }
}
