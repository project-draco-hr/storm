{
  _collector.setAnchor(input);
  TransactionAttempt attempt=(TransactionAttempt)input.getValue(0);
  String stream=input.getSourceStreamId();
  ITransactionalBolt bolt=_openTransactions.get(attempt);
  if (stream.equals(TransactionalSpoutCoordinator.TRANSACTION_COMMIT_STREAM_ID)) {
    if (bolt != null) {
      ((ICommittable)bolt).commit();
      _collector.ack(input);
      _openTransactions.remove(attempt);
    }
 else {
      _collector.fail(input);
    }
  }
 else {
    if (bolt == null) {
      bolt=newTransactionalBolt();
      bolt.prepare(_conf,_context,_collector,attempt);
      _openTransactions.put(attempt,bolt);
    }
    if (!stream.equals(TransactionalSpoutCoordinator.TRANSACTION_BATCH_STREAM_ID)) {
      bolt.execute(input);
    }
    _collector.ack(input);
  }
}
