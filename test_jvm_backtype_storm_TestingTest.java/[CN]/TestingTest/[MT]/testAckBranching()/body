{
  Testing.withTrackedCluster(new TestJob(){
    @Override public void run(    Cluster cluster){
      AckTracker tracker=new AckTracker();
      FeederSpout feederSpout=ackTrackingFeeder(tracker,"num");
      TopologyBuilder builder=new TopologyBuilder();
      builder.setSpout("1",feederSpout);
      builder.setBolt("2",new IdentityBolt()).shuffleGrouping("1");
      builder.setBolt("3",new IdentityBolt()).shuffleGrouping("1");
      builder.setBolt("4",new AggBolt(4)).shuffleGrouping("2").shuffleGrouping("3");
      StormTopology topology=builder.createTopology();
      TrackedTopology tracked=Testing.mkTrackedTopology(cluster,topology);
      Testing.submitLocalTopology(cluster.getNimbus(),"test-acking2",new Config(),tracked.getTopology());
      feederSpout.feed(Utils.list(1));
      Testing.trackedWait(tracked,1);
      checker(tracker,0);
      feederSpout.feed(Utils.list(1));
      Testing.trackedWait(tracked,1);
      checker(tracker,2);
    }
  }
);
}
