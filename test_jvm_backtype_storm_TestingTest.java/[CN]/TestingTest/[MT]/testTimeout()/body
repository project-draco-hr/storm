{
  Config daemonConfig=new Config();
  daemonConfig.put(Config.TOPOLOGY_ENABLE_MESSAGE_TIMEOUTS,true);
  MkClusterParam mkClusterParam=new MkClusterParam();
  mkClusterParam.setDaemonConf(daemonConfig);
  Testing.withSimulatedTimeLocalCluster(mkClusterParam,new TestJob(){
    @Override public void run(    ILocalCluster cluster){
      AckFailMapTracker tracker=new AckFailMapTracker();
      FeederSpout feeder=createFeederSpout("field1");
      feeder.setAckFailDelegate(tracker);
      TopologyBuilder builder=new TopologyBuilder();
      builder.setSpout("1",feeder);
      builder.setBolt("2",new AckEveryOtherBolt()).globalGrouping("1");
      StormTopology topology=builder.createTopology();
      Config topologyConfig=new Config();
      topologyConfig.setMessageTimeoutSecs(10);
      Testing.submitLocalTopology(cluster.getNimbus(),"timeout-tester",topologyConfig,topology);
      feeder.feed(new Values("a"),1);
      feeder.feed(new Values("b"),2);
      feeder.feed(new Values("c"),3);
      Testing.advanceClusterTime(cluster,9);
      assertAcked(tracker,1,3);
      assertFalse(tracker.isFailed(2));
      Testing.advanceClusterTime(cluster,12);
      assertFailed(tracker,2);
    }
  }
);
}
