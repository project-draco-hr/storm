{
  MemoryTransactionalSpout spout=new MemoryTransactionalSpout(DATA,new Fields("word"),PARTITION_TAKE_PER_BATCH);
  TransactionalTopologyBuilder builder=new TransactionalTopologyBuilder("top-n-words","spout",spout,2);
  builder.setBolt("count",new KeyedCountUpdater(),5).fieldsGrouping("spout",new Fields("word"));
  builder.setBolt("rank",new RankN(TOP_AMOUNT),5).shuffleGrouping("count");
  builder.setBolt("merge",new MergeN(TOP_AMOUNT)).globalGrouping("rank");
  builder.setBolt("write-top-n",new WriteTopN()).shuffleGrouping("merge");
  LocalCluster cluster=new LocalCluster();
  Config config=new Config();
  config.setDebug(true);
  config.setMaxSpoutPending(3);
  cluster.submitTopology("top-n-topology",config,builder.buildTopology());
  Thread.sleep(3000);
  cluster.shutdown();
}
