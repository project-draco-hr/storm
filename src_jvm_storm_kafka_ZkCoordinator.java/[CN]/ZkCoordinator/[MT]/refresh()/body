{
  try {
    LOG.info("Refreshing partition manager connections");
    GlobalPartitionInformation brokerInfo=_reader.getBrokerInfo();
    Set<GlobalPartitionId> mine=new HashSet();
    for (    GlobalPartitionId partitionId : brokerInfo) {
      if (myOwnership(partitionId)) {
        mine.add(partitionId);
      }
    }
    Set<GlobalPartitionId> curr=_managers.keySet();
    Set<GlobalPartitionId> newPartitions=new HashSet<GlobalPartitionId>(mine);
    newPartitions.removeAll(curr);
    Set<GlobalPartitionId> deletedPartitions=new HashSet<GlobalPartitionId>(curr);
    deletedPartitions.removeAll(mine);
    LOG.info("Deleted partition managers: " + deletedPartitions.toString());
    for (    GlobalPartitionId id : deletedPartitions) {
      PartitionManager man=_managers.remove(id);
      man.close();
    }
    LOG.info("New partition managers: " + newPartitions.toString());
    for (    GlobalPartitionId id : newPartitions) {
      PartitionManager man=new PartitionManager(_connections,_topologyInstanceId,_state,_stormConf,_spoutConfig,id);
      _managers.put(id,man);
    }
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  _cachedList=new ArrayList<PartitionManager>(_managers.values());
  LOG.info("Finished refreshing");
}
