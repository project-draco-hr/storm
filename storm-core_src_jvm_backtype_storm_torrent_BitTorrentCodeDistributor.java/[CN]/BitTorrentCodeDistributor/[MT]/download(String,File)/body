{
  LOG.info("Initiating BitTorrent download.");
  InetAddress netAddr=InetAddress.getLocalHost();
  File destDir=torrentFile.getParentFile();
  LOG.info("Downloading with torrent file: {}",torrentFile.getAbsolutePath());
  LOG.info("Saving files to directory: {}",destDir.getAbsolutePath());
  SharedTorrent st=SharedTorrent.fromFile(torrentFile,destDir);
  Client client=new Client(netAddr,st);
  this.clients.put(topologyId,client);
  rebalanceRates();
  client.share(this.seedDuration);
  if (this.seedDuration == 0) {
    client.waitForCompletion();
  }
 else {
    LOG.info("Waiting for seeding to begin...");
    while (client.getState() != Client.ClientState.SEEDING && client.getState() != Client.ClientState.ERROR) {
      try {
        Thread.sleep(10);
      }
 catch (      InterruptedException e) {
      }
    }
  }
  LOG.info("BitTorrent download complete.");
  File srcDir=Paths.get(destDir.getPath(),topologyId).toFile();
  for (  File file : srcDir.listFiles()) {
    Files.copy(file.toPath(),destDir.toPath().resolve(file.getName()));
    file.delete();
  }
  srcDir.delete();
  List<File> files=new ArrayList<File>();
  for (  File file : destDir.listFiles()) {
    files.add(file);
  }
  return files;
}
