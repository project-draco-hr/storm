{
  this.conf=conf;
  this.sharedContext=sharedContext;
  this.iSupervisor=iSupervisor;
  this.active=true;
  this.upTime=Utils.makeUptimeComputer();
  this.stormVersion=VersionInfo.getVersion();
  this.workerThreadPids=new ConcurrentHashMap<String,String>();
  this.deadWorkers=new ConcurrentHashSet();
  List<ACL> acls=null;
  if (Utils.isZkAuthenticationConfiguredStormServer(conf)) {
    acls=SupervisorUtils.supervisorZkAcls();
  }
  try {
    this.stormClusterState=ClusterUtils.mkStormClusterState(conf,acls,new ClusterStateContext(DaemonType.SUPERVISOR));
  }
 catch (  Exception e) {
    LOG.error("supervisor can't create stormClusterState");
    throw Utils.wrapInRuntime(e);
  }
  try {
    this.localState=ConfigUtils.supervisorState(conf);
    this.localizer=Utils.createLocalizer(conf,ConfigUtils.supervisorLocalDir(conf));
  }
 catch (  IOException e) {
    throw Utils.wrapInRuntime(e);
  }
  this.supervisorId=iSupervisor.getSupervisorId();
  this.assignmentId=iSupervisor.getAssignmentId();
  try {
    this.hostName=Utils.hostname(conf);
  }
 catch (  UnknownHostException e) {
    throw Utils.wrapInRuntime(e);
  }
  this.currAssignment=new AtomicReference<Map<Long,LocalAssignment>>(new HashMap<Long,LocalAssignment>());
  this.heartbeatTimer=new StormTimer(null,new DefaultUncaughtExceptionHandler());
  this.eventTimer=new StormTimer(null,new DefaultUncaughtExceptionHandler());
  this.blobUpdateTimer=new StormTimer("blob-update-timer",new DefaultUncaughtExceptionHandler());
  this.assignmentVersions=new AtomicReference<Map<String,Map<String,Object>>>(new HashMap<String,Map<String,Object>>());
  this.syncRetry=new AtomicInteger(0);
  this.stormIdToProfileActions=new AtomicReference<Map<String,List<ProfileRequest>>>(new HashMap<String,List<ProfileRequest>>());
  this.workerManager=Utils.newInstance((String)conf.get(Config.STORM_SUPERVISOR_WORKER_MANAGER_PLUGIN));
  this.workerManager.prepareWorker(conf,localizer);
}
