{
  List<String> hostInfos=zkClient.getChildren().forPath("/code-distributor/" + topologyid);
  File destDir=metafile.getParentFile();
  List<File> downloadedFiles=Lists.newArrayList();
  for (  String absolutePathOnRemote : FileUtils.readLines(metafile)) {
    File localFile=new File(destDir,new File(absolutePathOnRemote).getName());
    boolean isSuccess=false;
    for (    String hostAndPort : hostInfos) {
      NimbusInfo nimbusInfo=NimbusInfo.parse(hostAndPort);
      try {
        LOG.info("Attempting to download meta file {} from remote {}",absolutePathOnRemote,nimbusInfo.toHostPortString());
        downloadFromHost(conf,absolutePathOnRemote,localFile.getAbsolutePath(),nimbusInfo.getHost(),nimbusInfo.getPort());
        downloadedFiles.add(localFile);
        isSuccess=true;
        break;
      }
 catch (      Exception e) {
        LOG.error("download failed from {}:{}, will try another endpoint ",nimbusInfo.getHost(),nimbusInfo.getPort(),e);
      }
    }
    if (!isSuccess) {
      throw new RuntimeException("File " + absolutePathOnRemote + " could not be downloaded from any endpoint");
    }
  }
  return downloadedFiles;
}
