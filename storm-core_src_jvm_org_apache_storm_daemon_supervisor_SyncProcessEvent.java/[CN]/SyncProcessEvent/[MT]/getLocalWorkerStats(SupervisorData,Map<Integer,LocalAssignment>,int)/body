{
  Map<String,StateHeartbeat> workerIdHbstate=new HashMap<>();
  Map conf=supervisorData.getConf();
  LocalState localState=supervisorData.getLocalState();
  Map<String,LSWorkerHeartbeat> idToHeartbeat=SupervisorUtils.readWorkerHeartbeats(conf);
  Map<String,Integer> approvedWorkers=localState.getApprovedWorkers();
  Set<String> approvedIds=new HashSet<>();
  if (approvedWorkers != null) {
    approvedIds.addAll(approvedWorkers.keySet());
  }
  for (  Map.Entry<String,LSWorkerHeartbeat> entry : idToHeartbeat.entrySet()) {
    String workerId=entry.getKey();
    LSWorkerHeartbeat whb=entry.getValue();
    State state;
    if (whb == null) {
      state=State.NOT_STARTED;
    }
 else     if (!approvedIds.contains(workerId) || !matchesAssignment(whb,assignedExecutors)) {
      state=State.DISALLOWED;
    }
 else     if (supervisorData.getDeadWorkers().contains(workerId)) {
      LOG.info("Worker Process {} has died",workerId);
      state=State.TIMED_OUT;
    }
 else     if (SupervisorUtils.isWorkerHbTimedOut(now,whb,conf)) {
      state=State.TIMED_OUT;
    }
 else {
      state=State.VALID;
    }
    LOG.debug("Worker:{} state:{} WorkerHeartbeat:{} at supervisor time-secs {}",workerId,state,whb,now);
    workerIdHbstate.put(workerId,new StateHeartbeat(state,whb));
  }
  return workerIdHbstate;
}
