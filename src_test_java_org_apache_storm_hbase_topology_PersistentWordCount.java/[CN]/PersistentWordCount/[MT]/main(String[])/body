{
  Config config=new Config();
  WordSpout spout=new WordSpout();
  WordCounter bolt=new WordCounter();
  SimpleHBaseMapper mapper=new SimpleHBaseMapper().withRowKeyField("word").withColumnFields(new Fields("word")).withCounterFields(new Fields("count")).withColumnFamily("cf");
  HBaseBolt hbase=new HBaseBolt("WordCount",mapper);
  TopologyBuilder builder=new TopologyBuilder();
  builder.setSpout(WORD_SPOUT,spout,1);
  builder.setBolt(COUNT_BOLT,bolt,1).shuffleGrouping(WORD_SPOUT);
  builder.setBolt(HBASE_BOLT,hbase,1).fieldsGrouping(COUNT_BOLT,new Fields("word"));
  if (args.length == 0) {
    LocalCluster cluster=new LocalCluster();
    cluster.submitTopology("test",config,builder.createTopology());
    Thread.sleep(10000);
    cluster.killTopology("test");
    cluster.shutdown();
    System.exit(0);
  }
 else {
    config.setNumWorkers(3);
    StormSubmitter.submitTopology(args[0],config,builder.createTopology());
  }
}
