{
  if ((Boolean)_openOrPrepareWasCalled.deref() == true) {
    throw new RuntimeException("TopologyContext.registerMetric can only be called from within overridden " + "IBolt::prepare() or ISpout::open() method.");
  }
  Map m1=_registeredMetrics;
  if (!m1.containsKey(timeBucketSizeInSecs)) {
    m1.put(timeBucketSizeInSecs,new HashMap());
  }
  Map m2=(Map)m1.get(timeBucketSizeInSecs);
  if (!m2.containsKey(_taskId)) {
    m2.put(_taskId,new ArrayList());
  }
  Collection c1=(Collection)m2.get(_taskId);
  c1.add(new MetricHolder(name,metric));
  return metric;
}
