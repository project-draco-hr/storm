{
  T ret;
  try {
    ret=metrics.register(name,metric);
  }
 catch (  IllegalArgumentException e) {
    ret=(T)metrics.getMetrics().get(name);
    if (ret == null) {
      throw e;
    }
 else {
      LOG.warn("Metric {} has already been registered",name);
    }
  }
  return ret;
}
