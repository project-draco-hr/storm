{
  MemoryTransactionalSpout spout=new MemoryTransactionalSpout(DATA,new Fields("word"),PARTITION_TAKE_PER_BATCH);
  TransactionalTopologyBuilder builder=new TransactionalTopologyBuilder("global-count","spout",spout,2);
  builder.setBolt("partial-count",new BatchCount(),5).shuffleGrouping("spout");
  builder.setCommitterBolt("sum",new BatchSum()).globalGrouping("partial-count");
  builder.setBolt("to-db",new CommitToDB()).shuffleGrouping("sum");
  LocalCluster cluster=new LocalCluster();
  Config config=new Config();
  config.setDebug(true);
  config.setMaxSpoutPending(3);
  cluster.submitTopology("global-count-topology",config,builder.buildTopology());
  Thread.sleep(3000);
  cluster.shutdown();
}
