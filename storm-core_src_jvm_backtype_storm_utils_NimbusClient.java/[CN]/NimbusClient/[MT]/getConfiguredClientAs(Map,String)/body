{
  try {
    if (conf.containsKey(Config.STORM_DO_AS_USER)) {
      if (asUser != null && !asUser.isEmpty()) {
        LOG.warn("You have specified a doAsUser as param {} and a doAsParam as config, config will take precedence.",asUser,conf.get(Config.STORM_DO_AS_USER));
      }
      asUser=(String)conf.get(Config.STORM_DO_AS_USER);
    }
    String nimbusHost=(String)conf.get(Config.NIMBUS_HOST);
    return new NimbusClient(conf,nimbusHost,null,null,asUser);
  }
 catch (  TTransportException ex) {
    throw new RuntimeException(ex);
  }
}
