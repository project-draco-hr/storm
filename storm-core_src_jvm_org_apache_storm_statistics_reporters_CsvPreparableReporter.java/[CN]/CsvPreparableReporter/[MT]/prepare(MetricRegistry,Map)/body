{
  LOG.info("Preparing...");
  CsvReporter.Builder builder=CsvReporter.forRegistry(metricsRegistry);
  Locale locale=(Locale)stormConf.get(":locale");
  if (locale != null) {
    builder.formatFor(locale);
  }
  String rateUnit=Utils.getString(stormConf.get(":rate-unit"),null);
  if (rateUnit != null) {
    builder.convertRatesTo(TimeUnit.valueOf(rateUnit));
  }
  String durationUnit=Utils.getString(stormConf.get(":duration-unit"),null);
  if (durationUnit != null) {
    builder.convertDurationsTo(TimeUnit.valueOf(durationUnit));
  }
  MetricFilter filter=(MetricFilter)stormConf.get(":filter");
  if (filter != null) {
    builder.filter(filter);
  }
  String localStormDirLocation=Utils.getString(stormConf.get(Config.STORM_LOCAL_DIR),".");
  File logDir=new File(localStormDirLocation + "csvmetrics");
  validateCreateOutputDir(logDir);
  reporter=builder.build(logDir);
}
