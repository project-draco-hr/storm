{
  Channel channel=channelRef.get();
  if (containsMessages(messageBatch)) {
    if (connectionEstablished(channel)) {
      if (channel.isWritable()) {
        pauseBackgroundFlushing();
        MessageBatch toBeFlushed=messageBatch;
        flushMessages(channel,toBeFlushed);
        messageBatch=null;
      }
 else       if (closing) {
        resumeBackgroundFlushing();
      }
    }
 else {
      closeChannelAndReconnect(channel);
    }
  }
}
