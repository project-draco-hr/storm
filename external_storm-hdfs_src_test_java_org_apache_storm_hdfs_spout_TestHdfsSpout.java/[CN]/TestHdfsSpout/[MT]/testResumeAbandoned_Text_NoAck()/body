{
  Path file1=new Path(source.toString() + "/file1.txt");
  createTextFile(file1,6);
  final Integer lockExpirySec=1;
  Map conf=getDefaultConfig();
  conf.put(Configs.COMMIT_FREQ_COUNT,"1");
  conf.put(Configs.COMMIT_FREQ_SEC,"1000");
  conf.put(Configs.LOCK_TIMEOUT,lockExpirySec.toString());
  HdfsSpout spout=makeSpout(0,conf,Configs.TEXT);
  HdfsSpout spout2=makeSpout(1,conf,Configs.TEXT);
  List<String> res=runSpout(spout,"r2");
  Assert.assertEquals(2,res.size());
  FileLock lock=getField(spout,"lock");
  TestFileLock.closeUnderlyingLockFile(lock);
  Thread.sleep(lockExpirySec * 2 * 1000);
  Assert.assertTrue(fs.exists(lock.getLockFile()));
  List<String> res2=runSpout(spout2,"r3");
  Assert.assertEquals(3,res2.size());
  Assert.assertTrue(fs.exists(lock.getLockFile()));
  List<String> contents=readTextFile(fs,lock.getLockFile().toString());
  System.err.println(contents);
  res2=runSpout(spout2,"r2");
  Assert.assertEquals(4,res2.size());
  Assert.assertFalse(fs.exists(lock.getLockFile()));
}
