{
  SettableBlobMeta metadata=new SettableBlobMeta(BlobStoreAclHandler.WORLD_EVERYTHING);
  metadata.set_replication_factor(4);
  AtomicOutputStream out=store.createBlob("test",metadata,null);
  out.write(1);
  out.close();
  assertStoreHasExactly(store,"test");
  assertEquals("Blobstore replication not matching",store.getBlobReplication("test",null),4);
  store.deleteBlob("test",null);
  Subject admin=getSubject("admin");
  metadata=new SettableBlobMeta(BlobStoreAclHandler.DEFAULT);
  metadata.set_replication_factor(4);
  out=store.createBlob("test",metadata,admin);
  out.write(1);
  out.close();
  assertStoreHasExactly(store,"test");
  assertEquals("Blobstore replication not matching",store.getBlobReplication("test",admin),4);
  store.updateBlobReplication("test",5,admin);
  assertEquals("Blobstore replication not matching",store.getBlobReplication("test",admin),5);
  store.deleteBlob("test",admin);
  Subject supervisor=getSubject("supervisor");
  metadata=new SettableBlobMeta(BlobStoreAclHandler.DEFAULT);
  metadata.set_replication_factor(4);
  out=store.createBlob("test",metadata,supervisor);
  out.write(1);
  out.close();
  assertStoreHasExactly(store,"test");
  assertEquals("Blobstore replication not matching",store.getBlobReplication("test",supervisor),4);
  store.updateBlobReplication("test",5,supervisor);
  assertEquals("Blobstore replication not matching",store.getBlobReplication("test",supervisor),5);
  store.deleteBlob("test",supervisor);
  String createSubject="createSubject";
  String writeSubject="writeSubject";
  String adminSubject="adminSubject";
  Subject who=getSubject(createSubject);
  AccessControl writeAccess=new AccessControl(AccessControlType.USER,READ);
  AccessControl adminAccess=new AccessControl(AccessControlType.USER,ADMIN);
  writeAccess.set_name(writeSubject);
  adminAccess.set_name(adminSubject);
  List<AccessControl> acl=Arrays.asList(writeAccess,adminAccess);
  metadata=new SettableBlobMeta(acl);
  metadata.set_replication_factor(4);
  out=store.createBlob("test",metadata,who);
  out.write(1);
  out.close();
  assertStoreHasExactly(store,"test");
  who=getSubject(writeSubject);
  assertEquals("Blobstore replication not matching",store.getBlobReplication("test",who),4);
  who=getSubject(adminSubject);
  store.updateBlobReplication("test",5,who);
  assertEquals("Blobstore replication not matching",store.getBlobReplication("test",who),5);
  store.deleteBlob("test",getSubject(createSubject));
}
