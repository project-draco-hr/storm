{
  LOG.info("Initiating BitTorrent download.");
  File destDir=torrentFile.getParentFile();
  LOG.info("Downloading with torrent file: {}",torrentFile.getAbsolutePath());
  LOG.info("Saving files to directory: {}",destDir.getAbsolutePath());
  SharedTorrent st=SharedTorrent.fromFile(torrentFile,destDir);
  Client client=new Client(getInetAddress(),st);
  this.clients.put(topologyId,client);
  rebalanceRates();
  client.share(this.seedDuration);
  if (this.seedDuration == 0) {
    client.waitForCompletion();
  }
 else {
    LOG.info("Waiting for seeding to begin...");
    while (client.getState() != Client.ClientState.SEEDING && client.getState() != Client.ClientState.ERROR) {
      try {
        Thread.sleep(10);
      }
 catch (      InterruptedException e) {
      }
    }
  }
  LOG.info("BitTorrent download complete.");
  File srcDir=new File(destDir,topologyId);
  for (  File file : srcDir.listFiles()) {
    FileUtils.copyFileToDirectory(file,destDir);
    file.delete();
  }
  srcDir.delete();
  return Lists.newArrayList(destDir.listFiles());
}
