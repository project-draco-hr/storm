{
  LOG.debug("Preparing...");
  CsvReporter.Builder builder=CsvReporter.forRegistry(metricsRegistry);
  Locale locale=MetricsUtils.getMetricsReporterLocale(stormConf);
  if (locale != null) {
    builder.formatFor(locale);
  }
  TimeUnit rateUnit=MetricsUtils.getMetricsRateUnit(stormConf);
  if (rateUnit != null) {
    builder.convertRatesTo(rateUnit);
  }
  TimeUnit durationUnit=MetricsUtils.getMetricsDurationUnit(stormConf);
  if (durationUnit != null) {
    builder.convertDurationsTo(durationUnit);
  }
  String localStormDirLocation=Utils.getString(stormConf.get(Config.STORM_LOCAL_DIR),".");
  File csvMetricsDir=new File(localStormDirLocation + System.getProperty("file.separator") + "csvmetrics");
  validateCreateOutputDir(csvMetricsDir);
  reporter=builder.build(csvMetricsDir);
}
