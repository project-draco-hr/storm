{
  JSONObject msg=(JSONObject)readMessage();
  Emission emission=new Emission();
  String command=(String)msg.get("command");
  emission.setCommand(command);
  String stream=(String)msg.get("stream");
  if (stream == null)   stream=Utils.DEFAULT_STREAM_ID;
  emission.setStream(stream);
  Object taskObj=msg.get("task");
  if (taskObj != null) {
    emission.setTask((Long)taskObj);
  }
  emission.setTuple((List)msg.get("tuple"));
  List<Tuple> anchors=new ArrayList<Tuple>();
  Object anchorObj=msg.get("anchors");
  if (anchorObj != null) {
    if (anchorObj instanceof String) {
      anchorObj=Arrays.asList(anchorObj);
    }
    for (    Object o : (List)anchorObj) {
      emission.addAnchor((String)o);
    }
  }
  return emission;
}
