{
  JSONObject msg=(JSONObject)readMessage();
  ShellMsg shellMsg=new ShellMsg();
  String command=(String)msg.get("command");
  shellMsg.setCommand(command);
  String stream=(String)msg.get("stream");
  if (stream == null)   stream=Utils.DEFAULT_STREAM_ID;
  shellMsg.setStream(stream);
  Object taskObj=msg.get("task");
  if (taskObj != null) {
    shellMsg.setTask((Long)taskObj);
  }
  shellMsg.setTuple((List)msg.get("tuple"));
  List<Tuple> anchors=new ArrayList<Tuple>();
  Object anchorObj=msg.get("anchors");
  if (anchorObj != null) {
    if (anchorObj instanceof String) {
      anchorObj=Arrays.asList(anchorObj);
    }
    for (    Object o : (List)anchorObj) {
      shellMsg.addAnchor((String)o);
    }
  }
  return shellMsg;
}
