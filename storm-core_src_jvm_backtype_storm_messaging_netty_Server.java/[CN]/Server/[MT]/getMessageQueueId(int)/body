{
  Integer queueId=taskToQueueId.get(task);
  if (null == queueId) {
synchronized (this) {
      queueId=taskToQueueId.get(task);
      if (queueId == null) {
        queueId=roundRobinQueueId++;
        if (roundRobinQueueId == queueCount) {
          roundRobinQueueId=0;
        }
        HashMap<Integer,Integer> newRef=new HashMap<Integer,Integer>(taskToQueueId);
        newRef.put(task,queueId);
        taskToQueueId=newRef;
      }
    }
  }
  return queueId;
}
