{
  TreeMap<Long,Integer> ret=new TreeMap<Long,Integer>();
  for (  TransactionalState state : _states) {
    Map<Number,Number> attempts=(Map)state.getData(CURRENT_ATTEMPTS);
    if (attempts == null)     attempts=new HashMap();
    for (    Number n : attempts.keySet()) {
      long txid=n.longValue();
      int attemptId=((Number)attempts.get(txid)).intValue();
      Integer curr=ret.get(txid);
      if (curr == null || attemptId > curr) {
        ret.put(txid,attemptId);
      }
    }
  }
  ret.headMap(currTransaction).clear();
  ret.tailMap(currTransaction + maxBatches - 1).clear();
  return ret;
}
