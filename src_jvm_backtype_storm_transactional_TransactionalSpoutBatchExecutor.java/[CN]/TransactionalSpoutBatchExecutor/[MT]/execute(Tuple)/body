{
  TransactionAttempt attempt=(TransactionAttempt)input.getValue(0);
  if (input.getSourceStreamId().equals(TransactionalSpoutCoordinator.TRANSACTION_COMMIT_STREAM_ID)) {
    _collector.ack(input);
    _emitter.cleanupBefore(attempt.getTransactionId());
  }
 else {
    try {
      _emitter.emitBatch(attempt,input.getValue(1),_collector);
      _collector.ack(input);
    }
 catch (    FailedTransactionException e) {
      LOG.warn("Failed to emit batch for transaction",e);
      _collector.fail(input);
    }
  }
}
