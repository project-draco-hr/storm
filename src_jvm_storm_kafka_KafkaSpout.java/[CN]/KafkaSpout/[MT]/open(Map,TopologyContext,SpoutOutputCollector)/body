{
  _collector=collector;
  Map stateConf=new HashMap(conf);
  List<String> zkServers=_spoutConfig.zkServers;
  if (zkServers == null)   zkServers=(List<String>)conf.get(Config.STORM_ZOOKEEPER_SERVERS);
  Integer zkPort=_spoutConfig.zkPort;
  if (zkPort == null)   zkPort=((Number)conf.get(Config.STORM_ZOOKEEPER_PORT)).intValue();
  stateConf.put(Config.TRANSACTIONAL_ZOOKEEPER_SERVERS,zkServers);
  stateConf.put(Config.TRANSACTIONAL_ZOOKEEPER_PORT,zkPort);
  stateConf.put(Config.TRANSACTIONAL_ZOOKEEPER_ROOT,_spoutConfig.zkRoot);
  _state=new ZkState(stateConf);
  _connections=new DynamicPartitionConnections(_spoutConfig);
  int totalTasks=context.getComponentTasks(context.getThisComponentId()).size();
  if (_spoutConfig.hosts instanceof KafkaConfig.StaticHosts) {
    _coordinator=new StaticCoordinator(_connections,_spoutConfig,_state,context.getThisTaskIndex(),totalTasks,_uuid);
  }
 else {
    _coordinator=new ZkCoordinator(_connections,conf,_spoutConfig,_state,context.getThisTaskIndex(),totalTasks,_uuid);
  }
}
