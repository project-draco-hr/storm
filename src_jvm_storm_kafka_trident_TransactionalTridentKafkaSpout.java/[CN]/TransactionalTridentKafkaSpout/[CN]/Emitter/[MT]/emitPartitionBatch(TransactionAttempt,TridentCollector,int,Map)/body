{
  String instanceId=(String)meta.get("instanceId");
  if (!_config.forceFromStart || instanceId.equals(_topologyInstanceId)) {
    SimpleConsumer consumer=_connections.getConsumer(partition);
    long offset=(Long)meta.get("offset");
    long nextOffset=(Long)meta.get("nextOffset");
    ByteBufferMessageSet msgs=consumer.fetch(new FetchRequest(_config.topic,partition % partitionsPerHost,offset,_config.fetchSizeBytes));
    for (    MessageAndOffset msg : msgs) {
      if (offset == nextOffset)       break;
      if (offset > nextOffset) {
        throw new RuntimeException("Error when re-emitting batch. overshot the end offset");
      }
      KafkaUtils.emit(_config,attempt,collector,msg.message());
      offset=msg.offset();
    }
  }
}
