{
  LinearDRPCTopologyBuilder builder=new LinearDRPCTopologyBuilder("reach");
  builder.addBolt(new GetTweeters(),3);
  builder.addBolt(new GetFollowers(),12).shuffleGrouping();
  builder.addBolt(new PartialUniquer(),6).fieldsGrouping(new Fields("id","follower"));
  builder.addBolt(new CountAggregator(),2).fieldsGrouping(new Fields("id"));
  Config conf=new Config();
  if (args == null || args.length == 0) {
    conf.setMaxTaskParallelism(3);
    LocalDRPC drpc=new LocalDRPC();
    LocalCluster cluster=new LocalCluster();
    cluster.submitTopology("reach-drpc",conf,builder.createLocalTopology(drpc));
    String[] urlsToTry=new String[]{"foo.com/blog/1","engineering.twitter.com/blog/5","notaurl.com"};
    for (    String url : urlsToTry) {
      System.out.println("Reach of " + url + ": "+ drpc.execute("reach",url));
    }
    cluster.shutdown();
    drpc.shutdown();
  }
 else {
    conf.setNumWorkers(6);
    StormSubmitter.submitTopology(args[0],conf,builder.createRemoteTopology());
  }
}
