{
  while (_running) {
    try {
      if (sendHeartbeatFlag.get()) {
        LOG.debug("BOLT - sending heartbeat request to subprocess");
        String genId=Long.toString(_rand.nextLong());
        _process.writeBoltMsg(createHeartbeatBoltMessage(genId));
        sendHeartbeatFlag.compareAndSet(true,false);
      }
      List<Integer> taskIds=_pendingTaskIds.peek();
      if (taskIds != null) {
        taskIds=_pendingTaskIds.poll();
        _process.writeTaskIds(taskIds);
        continue;
      }
      BoltMsg write=_pendingWrites.peek();
      if (write != null) {
        write=_pendingWrites.poll();
        _process.writeBoltMsg(write);
      }
    }
 catch (    Throwable t) {
      die(t);
    }
  }
}
