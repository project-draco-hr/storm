{
  if (obj instanceof ControlMessage) {
    ControlMessage message=(ControlMessage)obj;
    ChannelBufferOutputStream bout=new ChannelBufferOutputStream(ChannelBuffers.dynamicBuffer(estimated_buffer_size,ctx.getChannel().getConfig().getBufferFactory()));
    writeControlMessage(bout,message);
    bout.close();
    return bout.buffer();
  }
  if (obj instanceof TaskMessage) {
    TaskMessage message=(TaskMessage)obj;
    ChannelBufferOutputStream bout=new ChannelBufferOutputStream(ChannelBuffers.dynamicBuffer(estimated_buffer_size,ctx.getChannel().getConfig().getBufferFactory()));
    writeTaskMessage(bout,message);
    bout.close();
    return bout.buffer();
  }
  if (obj instanceof ArrayList<?>) {
    ChannelBufferOutputStream bout=new ChannelBufferOutputStream(ChannelBuffers.dynamicBuffer(estimated_buffer_size,ctx.getChannel().getConfig().getBufferFactory()));
    ArrayList<TaskMessage> messages=(ArrayList<TaskMessage>)obj;
    for (    TaskMessage message : messages)     writeTaskMessage(bout,message);
    writeControlMessage(bout,ControlMessage.EOB_MESSAGE);
    bout.close();
    return bout.buffer();
  }
  return null;
}
