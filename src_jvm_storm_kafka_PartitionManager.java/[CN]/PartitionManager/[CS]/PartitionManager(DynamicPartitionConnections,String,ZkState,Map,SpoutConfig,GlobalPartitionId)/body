{
  _partition=id;
  _connections=connections;
  _spoutConfig=spoutConfig;
  _topologyInstanceId=topologyInstanceId;
  _consumer=connections.register(id.host,id.partition);
  _state=state;
  _stormConf=stormConf;
  Map<Object,Object> st=_state.readJSON(committedPath());
  if (st == null || (!topologyInstanceId.equals((String)st.get("topology-id")) && spoutConfig.forceFromStart)) {
    _committedTo=_consumer.getOffsetsBefore(spoutConfig.topic,id.partition,spoutConfig.startOffsetTime,1)[0];
  }
 else {
    _committedTo=(Long)st.get("offset");
    LOG.info("Read last commit offset from zookeeper: " + _committedTo);
  }
  LOG.info("Starting Kafka " + _consumer.host() + ":"+ id.partition+ " from offset "+ _committedTo);
  _emittedToOffset=_committedTo;
}
