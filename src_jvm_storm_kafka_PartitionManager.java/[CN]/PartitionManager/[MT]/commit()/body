{
  LOG.info("Committing offset for " + _partition);
  long committedTo;
  if (_pending.isEmpty()) {
    committedTo=_emittedToOffset;
  }
 else {
    committedTo=_pending.first();
  }
  if (committedTo != _committedTo) {
    LOG.info("Writing committed offset to ZK: " + committedTo);
    Map<String,Object> data=new LinkedHashMap<String,Object>();
    data.put("id",_topologyInstanceId);
    data.put("offset",committedTo);
    _state.writeJSON(committedPath(),data);
    LOG.info("Wrote committed offset to ZK: " + committedTo);
    _committedTo=committedTo;
  }
  LOG.info("Comitted offset for " + _partition);
}
